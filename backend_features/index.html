<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="./tus.min.js"></script>
  <title>Upload test</title>
</head>
<body>
  <div class="container-fluid mt-4 col-6">
    <div class="mb-4">
      <h4>Upload</h4>
      <input type="file" >
    </div>
    <div>
      <h5>Progress</h5>
      <div class="progress">
        <div class="progress-bar progress-bar-striped bg-success progress-bar-animated" role="progressbar"
          aria-label="Animated striped example" style="width: 0%">
        </div>
      </div>
    </div>
  </div>
      <script>
        const progressBar = document.querySelector('.progress-bar');
        const status = document.querySelector(".status");
        const input = document.querySelector("input");
        input.addEventListener('change', function (e) {
          // Get the selected file from the input element
          var file = e.target.files[0]

          // Create a new tus upload
          var upload = new tus.Upload(file, {
            endpoint: 'http://localhost:8080/files/',
            retryDelays: [0, 3000, 5000, 10000, 20000],
            metadata: {
              filename: file.name,
              filetype: file.type,
            },
            onError: function (error) {
              console.log('Failed because: ' + error)
            },
            onProgress: function (bytesUploaded, bytesTotal) {
              var percentage = ((bytesUploaded / bytesTotal) * 100).toFixed(0)
              console.log(percentage);
              progressBar.style.width = `${percentage}%`;
            },
            onSuccess: function () {
              console.log('Download %s from %s', upload.file.name, upload.url)
            },
          })

          // Check if there are any previous uploads to continue.
          upload.findPreviousUploads().then(function (previousUploads) {
            // Found previous uploads so we select the first one.
            if (previousUploads.length) {
              upload.resumeFromPreviousUpload(previousUploads[0])
            }

            // Start the upload
            upload.start()
          })
        })
      </script>
</body>
</html>